{% extends "base.html" %}

{% block title %}Secrets Manager - AWS{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <h1 class="mb-4">
            <i class="bi bi-key"></i> AWS Secrets Manager
        </h1>
        <p class="text-muted">Gerencie segredos, credenciais e configurações sensíveis de forma segura</p>
    </div>
</div>

<!-- Alertas -->
<div id="alertContainer"></div>

<!-- Tabs -->
<ul class="nav nav-tabs mb-4" id="secretsTabs" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="all-secrets-tab" data-bs-toggle="tab" data-bs-target="#all-secrets" type="button">
            <i class="bi bi-key"></i> Todos os Segredos
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="favorites-tab" data-bs-toggle="tab" data-bs-target="#favorites" type="button">
            <i class="bi bi-star-fill text-warning"></i> Favoritos
        </button>
    </li>
</ul>

<div class="tab-content" id="secretsTabContent">
    <!-- Tab Todos os Segredos -->
    <div class="tab-pane fade show active" id="all-secrets" role="tabpanel">
        <div class="row mb-3">
            <div class="col-md-8">
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-search"></i></span>
                    <input type="text" class="form-control" id="secretsFilter" placeholder="Filtrar segredos por nome...">
                    <button class="btn btn-outline-secondary" id="clearFilterBtn" title="Limpar filtro">
                        <i class="bi bi-x"></i>
                    </button>
                </div>
                <small class="text-muted">Digite para filtrar em tempo real</small>
            </div>
            <div class="col-md-4 text-end">
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createSecretModal">
                    <i class="bi bi-plus-circle"></i> Criar
                </button>
                <button class="btn btn-secondary" id="refreshSecretsBtn">
                    <i class="bi bi-arrow-clockwise"></i> Atualizar
                </button>
            </div>
        </div>
        
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="bi bi-list-ul"></i> Segredos</h5>
            </div>
            <div class="card-body">
                <div id="secretsContainer">
                    <div class="text-center">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Carregando...</span>
                        </div>
                        <p class="mt-2">Carregando segredos...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Tab Favoritos -->
    <div class="tab-pane fade" id="favorites" role="tabpanel">
        <div class="row mb-3">
            <div class="col-md-8">
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-search"></i></span>
                    <input type="text" class="form-control" id="favoritesFilter" placeholder="Filtrar favoritos...">
                    <button class="btn btn-outline-secondary" id="clearFavoritesFilterBtn" title="Limpar filtro">
                        <i class="bi bi-x"></i>
                    </button>
                </div>
                <small class="text-muted">Digite para filtrar seus segredos favoritos</small>
            </div>
            <div class="col-md-4 text-end">
                <button class="btn btn-warning" id="refreshFavoritesBtn">
                    <i class="bi bi-arrow-clockwise"></i> Atualizar
                </button>
            </div>
        </div>
        
        <div class="card shadow-sm">
            <div class="card-header bg-warning">
                <h5 class="mb-0"><i class="bi bi-star-fill"></i> Segredos Favoritos</h5>
            </div>
            <div class="card-body">
                <div id="favoritesContainer">
                    <div class="text-center">
                        <div class="spinner-border text-warning" role="status"></div>
                        <p class="mt-2">Carregando favoritos...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal para criar segredo -->
<div class="modal fade" id="createSecretModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title"><i class="bi bi-plus-circle"></i> Criar Novo Segredo</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="createSecretForm">
                    <div class="mb-3">
                        <label for="secretName" class="form-label">Nome do Segredo *</label>
                        <input type="text" class="form-control" id="secretName" required
                               placeholder="ex: prod/db/password">
                        <small class="text-muted">Caracteres permitidos: a-z A-Z 0-9 / _ + = . @ -</small>
                    </div>
                    
                    <div class="mb-3">
                        <label for="secretDescription" class="form-label">Descrição</label>
                        <input type="text" class="form-control" id="secretDescription"
                               placeholder="Descrição do segredo">
                    </div>
                    
                    <div class="mb-3">
                        <label for="secretValueType" class="form-label">Tipo de Valor</label>
                        <select class="form-select" id="secretValueType">
                            <option value="plaintext">Texto Simples</option>
                            <option value="json">JSON (Key/Value)</option>
                        </select>
                    </div>
                    
                    <div id="plaintextContainer">
                        <div class="mb-3">
                            <label for="secretValuePlaintext" class="form-label">Valor do Segredo *</label>
                            <textarea class="form-control font-monospace" id="secretValuePlaintext" rows="4"
                                      placeholder="Digite o valor do segredo"></textarea>
                        </div>
                    </div>
                    
                    <div id="jsonContainer" style="display: none;">
                        <div class="mb-3">
                            <label class="form-label">Pares Chave/Valor</label>
                            <div id="jsonPairs">
                                <div class="row mb-2">
                                    <div class="col-md-5">
                                        <input type="text" class="form-control json-key" placeholder="Chave">
                                    </div>
                                    <div class="col-md-6">
                                        <input type="text" class="form-control json-value" placeholder="Valor">
                                    </div>
                                    <div class="col-md-1">
                                        <button type="button" class="btn btn-sm btn-danger" onclick="removeJsonPair(this)">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="btn btn-sm btn-secondary" onclick="addJsonPair()">
                                <i class="bi bi-plus"></i> Adicionar Par
                            </button>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" id="createSecretBtn">
                    <i class="bi bi-save"></i> Criar Segredo
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para visualizar valor do segredo -->
<div class="modal fade" id="viewSecretModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title"><i class="bi bi-eye"></i> Valor do Segredo</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-warning">
                    <i class="bi bi-exclamation-triangle"></i> 
                    <strong>Atenção:</strong> Não compartilhe este valor. Ele contém informações sensíveis.
                </div>
                
                <div class="mb-3">
                    <label class="form-label"><strong>Nome:</strong></label>
                    <p id="viewSecretName" class="font-monospace"></p>
                </div>
                
                <div class="mb-3">
                    <label class="form-label"><strong>Valor:</strong></label>
                    <div id="viewSecretValue"></div>
                </div>
                
                <button type="button" class="btn btn-sm btn-outline-secondary" id="copySecretBtn">
                    <i class="bi bi-clipboard"></i> Copiar Valor
                </button>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para atualizar segredo -->
<div class="modal fade" id="updateSecretModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-warning">
                <h5 class="modal-title"><i class="bi bi-pencil"></i> Atualizar Segredo</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label"><strong>Nome:</strong></label>
                    <p id="updateSecretName" class="font-monospace"></p>
                </div>
                
                <div class="mb-3">
                    <label for="updateSecretValue" class="form-label">Novo Valor *</label>
                    <textarea class="form-control font-monospace" id="updateSecretValue" rows="4"
                              placeholder="Digite o novo valor"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-warning" id="updateSecretBtn">
                    <i class="bi bi-save"></i> Atualizar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para detalhes do segredo -->
<div class="modal fade" id="detailsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-info text-white">
                <h5 class="modal-title"><i class="bi bi-info-circle"></i> Detalhes do Segredo</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="detailsModalBody">
                <!-- Conteúdo será inserido via JavaScript -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/secrets.js') }}"></script>
{% endblock %}
